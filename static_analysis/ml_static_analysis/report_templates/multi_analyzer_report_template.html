<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>PyTorch LLM 分布式训练静态分析报告</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }
        h1, h2, h3 {
            color: #0366d6;
            border-bottom: 1px solid #eaecef;
            padding-bottom: 0.3em;
        }
        code {
            background-color: #f6f8fa;
            padding: 0.2em 0.4em;
            border-radius: 3px;
            font-family: SFMono-Regular, Consolas, "Liberation Mono", Menlo, monospace;
        }
        pre {
            background-color: #f6f8fa;
            padding: 16px;
            border-radius: 3px;
            overflow: auto;
        }
        .error {
            color: #d73a49;
            font-weight: bold;
        }
        .warning {
            color: #e36209;
            font-weight: bold;
        }
        .suggestion {
            color: #0366d6;
        }
        .analyzer-section {
            margin-top: 30px;
            padding: 15px;
            border: 1px solid #e1e4e8;
            border-radius: 6px;
            background-color: #f8f9fa;
        }
        .analyzer-header {
            background-color: #0366d6;
            color: white;
            padding: 10px;
            margin: -15px -15px 15px -15px;
            border-radius: 6px 6px 0 0;
        }
        .finding-item {
            margin-bottom: 15px;
            padding: 10px;
            border-left: 4px solid #dfe2e5;
        }
        .error-item {
            border-left-color: #d73a49;
            background-color: #ffeef0;
        }
        .warning-item {
            border-left-color: #e36209;
            background-color: #fff5e8;
        }
        .suggestion-item {
            border-left-color: #0366d6;
            background-color: #f1f8ff;
        }
        .file-path {
            font-family: SFMono-Regular, Consolas, "Liberation Mono", Menlo, monospace;
            color: #6a737d;
        }
        .summary-box {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        .summary-item {
            flex: 1;
            text-align: center;
            padding: 10px;
            border: 1px solid #e1e4e8;
            border-radius: 6px;
            margin: 0 5px;
        }
        .summary-item.errors {
            background-color: #ffeef0;
        }
        .summary-item.warnings {
            background-color: #fff5e8;
        }
        .summary-item.suggestions {
            background-color: #f1f8ff;
        }
        .summary-count {
            font-size: 24px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>PyTorch LLM 分布式训练静态分析报告</h1>
    
    <h2>分析元数据</h2>
    <ul>
        <li><strong>分析时间</strong>: {{timestamp}}</li>
        <li><strong>分析目标</strong>: {{target}}</li>
        <li><strong>分析器</strong>: {{analyzers}}</li>
    </ul>
    
    <h2>分析摘要</h2>
    <div class="summary-box">
        <div class="summary-item errors">
            <div class="summary-count">{{total_errors}}</div>
            <div>错误</div>
        </div>
        <div class="summary-item warnings">
            <div class="summary-count">{{total_warnings}}</div>
            <div>警告</div>
        </div>
        <div class="summary-item suggestions">
            <div class="summary-count">{{total_suggestions}}</div>
            <div>建议</div>
        </div>
    </div>
    
    {% for analyzer_name, analyzer_results in results.items() %}
    <div class="analyzer-section">
        <div class="analyzer-header">
            <h2 style="color: white; margin: 0;">{{analyzer_name}} 分析结果</h2>
        </div>
        
        {% if analyzer_results.summary %}
        <h3>摘要</h3>
        <pre>{{analyzer_results.summary}}</pre>
        {% endif %}
        
        {% if analyzer_results.errors %}
        <h3>错误 ({{analyzer_results.errors|length}})</h3>
        {% for error in analyzer_results.errors %}
        <div class="finding-item error-item">
            <div class="error">
                {% if error.code %}
                <strong>{{error.code}}</strong>: 
                {% endif %}
                {{error.message}}
                {% if error.category %}
                [{{error.category}}]
                {% endif %}
            </div>
            {% if error.file_path %}
            <div class="file-path">文件: {{error.file_path}}</div>
            {% endif %}
            {% if error.line %}
            <div>行号: {{error.line}}</div>
            {% endif %}
            {% if error.content %}
            <pre><code>{{error.content}}</code></pre>
            {% endif %}
        </div>
        {% endfor %}
        {% endif %}
        
        {% if analyzer_results.warnings %}
        <h3>警告 ({{analyzer_results.warnings|length}})</h3>
        {% for warning in analyzer_results.warnings %}
        <div class="finding-item warning-item">
            <div class="warning">
                {% if warning.code %}
                <strong>{{warning.code}}</strong>: 
                {% endif %}
                {{warning.message}}
                {% if warning.category %}
                [{{warning.category}}]
                {% endif %}
            </div>
            {% if warning.file_path %}
            <div class="file-path">文件: {{warning.file_path}}</div>
            {% endif %}
            {% if warning.line %}
            <div>行号: {{warning.line}}</div>
            {% endif %}
            {% if warning.content %}
            <pre><code>{{warning.content}}</code></pre>
            {% endif %}
        </div>
        {% endfor %}
        {% endif %}
        
        {% if analyzer_results.suggestions %}
        <h3>建议 ({{analyzer_results.suggestions|length}})</h3>
        {% for suggestion in analyzer_results.suggestions %}
        <div class="finding-item suggestion-item">
            <div class="suggestion">
                {% if suggestion.code %}
                <strong>{{suggestion.code}}</strong>: 
                {% endif %}
                {{suggestion.message}}
            </div>
            {% if suggestion.file_path %}
            <div class="file-path">文件: {{suggestion.file_path}}</div>
            {% endif %}
            {% if suggestion.line %}
            <div>行号: {{suggestion.line}}</div>
            {% endif %}
            {% if suggestion.content %}
            <pre><code>{{suggestion.content}}</code></pre>
            {% endif %}
        </div>
        {% endfor %}
        {% endif %}
    </div>
    {% endfor %}
    
    <h2>结论和建议</h2>
    
    {% if total_errors > 0 %}
    <h3>关键问题</h3>
    <p>以下是需要优先解决的关键问题:</p>
    
    {% for analyzer_name, analyzer_results in results.items() %}
      {% if analyzer_results.errors %}
        {% for error in analyzer_results.errors %}
        <div class="finding-item error-item">
            <div class="error">
                [{{analyzer_name}}] 
                {% if error.code %}
                <strong>{{error.code}}</strong>: 
                {% endif %}
                {{error.message}}
                {% if error.category %}
                [{{error.category}}]
                {% endif %}
            </div>
            {% if error.file_path %}
            <div class="file-path">文件: {{error.file_path}}</div>
            {% endif %}
            {% if error.line %}
            <div>行号: {{error.line}}</div>
            {% endif %}
        </div>
        {% endfor %}
      {% endif %}
    {% endfor %}
    {% endif %}
    
    {% for analyzer_name, analyzer_results in results.items() %}
    {% if analyzer_results.auto_fixable %}
    <h3>自动修复</h3>
    <p>以下问题可以通过自动修复工具解决:</p>
    
    {% for fixable in analyzer_results.auto_fixable|slice:":5" %}
    <div class="finding-item suggestion-item">
        <div class="suggestion">{{fixable.message}} ({{fixable.file_path}}:{{fixable.line}})</div>
    </div>
    {% endfor %}
    {% if analyzer_results.auto_fixable and analyzer_results.auto_fixable|length > 5 %}
    <p>... 以及 {{analyzer_results.auto_fixable|length - 5}} 个其他可自动修复的问题</p>
    {% endif %}
    {% endif %}
    {% endfor %}
</body>
</html>
